<!DOCTYPE html>
<html><head>
    <title>lr</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <style type="text/css">
		body
		{
			margin: 0px;
			padding: 0px;
		}
		
		#canvas
		{
			position: absolute;
			top: 0px;
			left: 0px;
			right: 0px;
			bottom: 0px;
		}
	</style>
</head>
<body>
	<canvas height="849" width="1278" id="canvas"></canvas>
	<script type="text/javascript" >var canva = document.getElementById('canvas');
canva.width = window.innerWidth;
canva.height = window.innerHeight;

var ctx = canva.getContext('2d');

function draw(figure) {
	for(i in figure){
		for(j in figure[i]){
			for(k in figure[i][j]){
				if(k==0){
					ii = 3*i+1
					jj = 3*j+2
				}
				if(k==1){
					ii = 3*i+2
					jj = 3*j+1
				}
				if(k==2){
					ii = 3*i+3
					jj = 3*j+2
				}
				if(k==3){
					ii = 3*i+2
					jj = 3*j+3
				}
				if(k==4){
					ii = 3*i+2
					jj = 3*j+2
				}

				if(k<4){
					if(figure[i][j][k]==1) ctx.fillStyle = '#ccc';
					else if(figure[i][j][k]==0) ctx.fillStyle = '#333';
					ctx.fillRect(15*jj+100, 15*ii+100, 10, 10);
					/*if(k==0){
						ctx.fillRect(15*jj+90, 15*ii+100, 5, 5);
						ctx.fillRect(15*jj+115, 15*ii+100, 5, 5);
					}
					if(k==1){
						ctx.fillRect(15*jj+100, 15*ii+90, 5, 5);
						ctx.fillRect(15*jj+100, 15*ii+115, 5, 5);
					}
					if(k==2){
						ctx.fillRect(15*jj+90, 15*ii+105, 5, 5);
						ctx.fillRect(15*jj+115, 15*ii+105, 5, 5);
					}
					if(k==3){
						ctx.fillRect(15*jj+105, 15*ii+90, 5, 5);
						ctx.fillRect(15*jj+105, 15*ii+115, 5, 5);
					}*/
				}
				else if(k==4){
					if(figure[i][j][k]==0) ctx.fillStyle = '#333';
					else if(figure[i][j][k]==1) ctx.fillStyle = '#e30';
					else if(figure[i][j][k]==2) ctx.fillStyle = '#000';
					else if(figure[i][j][k]==3) ctx.fillStyle = '#000';
					ctx.fillRect(15*jj+100, 15*ii+100, 10, 10);
				}
			}
		}
	}
}

function clear() {
    ctx.clearRect(0, 0, canva.width, canva.height)
    ctx.fillStyle = 'rgba(0,0,0,1)'
	ctx.fillRect(0, 0, canva.width, canva.height)
}

var figure = [
[[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0]],
[[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 1, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0]],
[[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0]],
[[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 1, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0]],
[[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0]],
[[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0]],
[[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0]],
[[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0],[0, 0, 0, 0, 0]],
];


function funcpre(a1,a2,a3,a4,k,type){
	if(type==0)
	var config = [
		[0,2,2],
		[1,1,1],
		[0,1,2],
		[1,1,2],
		[1,1,1],
		[1,2,2]
	]
	else if(type==1)
	var config = [
		[1,2,2],
		[0,0,0],
		[0,0,2],
		[0,0,2],
		[0,0,0],
		[0,2,2]
	]
	else if(type==2)
	var config = [
		[0,2,2],
		[0,0,0],
		[0,0,2],
		[0,0,2],
		[0,0,0],
		[0,2,2]
	]
	else if(type==3)
	var config = [
		[0,2,2],
		[0,0,0],
		[0,0,2],
		[0,0,2],
		[0,0,0],
		[0,2,2]
	]


	if(k==0){
		a = a1
		b = (a2+a4)%2
	}
	else if(k==1){
		a = a2
		b = (a1+a3)%2
	}
	else if(k==2){
		a = a3
		b = (a2+a4)%2
	}
	else if(k==3){
		a = a4
		b = (a1+a3)%2
	}
	else if(k==4){
		if(a1+a2+a3+a4<2)
			return type
		else 
			return ((type+1)%3)

	}
	
	
	if(a1+a2+a3+a4==0)
		config = config[0];
	else if(a1+a2+a3+a4==1)
		config = config[1];
	else if(a1+a2+a3+a4==2 && a1!=a2)
		config = config[2];
	else if(a1+a2+a3+a4==2 && a1==a2)
		config = config[3];
	else if(a1+a2+a3+a4==3)
		config = config[4];
	else if(a1+a2+a3+a4==4)
		config = config[5];

	value = (config[0]+config[1]*a+config[2]*b)%2

	return value;
}

l = figure.length


function clickfig(figure,x,y){
	xx = x%3
	yy = y%3
	x = (x-x%3)/3
	y = (y-y%3)/3
	k = 5
	if(xx==0 && yy==1)
		k = 1
	else if(xx==1 && yy==0)
		k = 0
	else if(xx==2 && yy==1)
		k = 3
	else if(xx==1 && yy==2)
		k = 2
	else if(xx==1 && yy==1)
		k = 4
	if(k!=5 && k!=4)
		figure[y][x][k] = (figure[y][x][k]+1)%2;
	else if(k==4)
		figure[y][x][k] = (figure[y][x][k]+1)%4;
	return figure
}

function transform(figure) {
	var figure2 = []
	for(i in figure){
		figure2[i] = []
		for(j in figure[i]){
			figure2[i][j] = []
			for(k in figure[i][j]){	
				figure2[i][j][k] = funcpre(
					figure[(l-1+(i-0))%l][j][2],
					figure[i][(l-1+(j-0))%l][3],
					figure[(l+1+(i-0))%l][j][0],
					figure[i][(l+1+(j-0))%l][1],
					k,
					figure[i][j][4]
				)
			}
		}
	}
	return figure2;
}
clear()

    canvas.onclick = function(e) {
        var x = Math.floor((e.pageX - 100)/15);
        var y = Math.floor((e.pageY - 100)/15);
		if(x<49 && x>0 && y<49 && y>0)
			figure = clickfig(figure,x-1,y-1);
    };
    
setInterval( function() { draw(figure); figure = transform(figure); }, 100)

</script>


</body></html>
